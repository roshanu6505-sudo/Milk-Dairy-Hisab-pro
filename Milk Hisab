<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Milk Dairy Hisab Pro (Secure)</title>
    <style>
        /* CSS Design */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 0; background-color: #f0f4f8; color: #333; }

        /* Auth Screens (Login/Register/Forgot) */
        .auth-screen { display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; background: linear-gradient(135deg, #007bff, #00c6ff); color: white; position: fixed; top: 0; left: 0; width: 100%; z-index: 200; }
        .login-box { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); text-align: center; width: 85%; max-width: 350px; }
        .login-box h2 { color: #007bff; margin-bottom: 5px; }
        .login-box input { width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box;}
        .login-link { color: #007bff; cursor: pointer; text-decoration: underline; font-size: 14px; margin-top: 15px; display: block; }
        
        .btn { background-color: #007bff; color: white; border: none; padding: 12px; border-radius: 8px; font-size: 18px; cursor: pointer; width: 100%; font-weight: bold; margin-top: 10px; transition: 0.3s; }
        .btn:hover { background-color: #0056b3; }
        .btn-danger { background-color: #ff4d4d; width: auto; padding: 5px 10px; font-size: 14px; }
        
        /* App Screen */
        #app-screen { display: none; }
        header { background-color: #007bff; color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 100; }
        .menu-icon { font-size: 24px; cursor: pointer; }
        
        /* Sidebar */
        #sidebar { height: 100%; width: 0; position: fixed; z-index: 101; top: 0; left: 0; background-color: #111; overflow-x: hidden; transition: 0.4s; padding-top: 60px; }
        #sidebar a { padding: 8px 8px 8px 32px; text-decoration: none; font-size: 20px; color: #818181; display: block; transition: 0.3s; }
        #sidebar a:hover { color: #f1f1f1; }
        .closebtn { position: absolute; top: 0; right: 25px; font-size: 36px; margin-left: 50px; }

        /* Content */
        .container { padding: 20px; max-width: 600px; margin: auto; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .form-group { margin-bottom: 15px; position: relative; }
        .form-group label { display: block; font-weight: bold; margin-bottom: 5px; color: #555; }
        .form-group input { width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        
        .voice-btn { position: absolute; right: 5px; top: 32px; background: #28a745; color: white; border: none; border-radius: 50%; width: 35px; height: 35px; cursor: pointer; }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; }
        th, td { border-bottom: 1px solid #ddd; padding: 10px 5px; text-align: left; }
        th { background-color: #f8f9fa; color: #333; }
        
        .total-box { background: #28a745; color: white; padding: 15px; border-radius: 10px; font-size: 20px; font-weight: bold; text-align: center; margin-bottom: 20px; box-shadow: 0 4px 10px rgba(40, 167, 69, 0.3); }

        .search-container { position: relative; margin-bottom: 15px; }
        .search-container input { width: 100%; padding: 10px 10px 10px 35px; border: 2px solid #007bff; border-radius: 20px; outline: none; }
        .search-icon { position: absolute; left: 12px; top: 12px; color: #007bff; }

        /* Print Media Query */
        @media print {
            #sidebar, header, .form-card, .btn-print, .auth-screen, .search-container, .voice-btn, .btn-danger { display: none !important; }
            #app-screen, .container { display: block !important; }
            .card { box-shadow: none; border: 1px solid #ddd; }
        }
    </style>
</head>
<body>

    <div id="register-screen" class="auth-screen" style="display:none;">
        <div class="login-box">
            <h2>üÜï Account Banayein</h2>
            <p style="color:#777; font-size:13px;">Pehli baar setup karein</p>
            <input type="text" id="reg-username" placeholder="Apna Username Set Karein">
            <input type="password" id="reg-password" placeholder="Naya Password">
            <input type="text" id="reg-secret" placeholder="Secret Code (Password bhulne par kaam ayega)">
            <button class="btn" onclick="registerUser()">Create Account</button>
        </div>
    </div>

    <div id="login-screen" class="auth-screen" style="display:none;">
        <div class="login-box">
            <h2>üîê Login Karein</h2>
            <p style="color:#777; margin-bottom:20px;">Doodh Wala Pro</p>
            <input type="text" id="login-username" placeholder="User ID">
            <input type="password" id="login-password" placeholder="Password">
            <button class="btn" onclick="login()">Login</button>
            <span class="login-link" onclick="showForgotScreen()">Password bhul gaye?</span>
        </div>
    </div>

    <div id="forgot-screen" class="auth-screen" style="display:none;">
        <div class="login-box">
            <h2 style="color:#ff4d4d">‚ö†Ô∏è Password Reset</h2>
            <p style="color:#777;">Apna Secret Code Dalein</p>
            <input type="text" id="reset-secret" placeholder="Wahi Secret Code dalein">
            <input type="password" id="new-password" placeholder="Naya Password banayein">
            <button class="btn" onclick="resetPassword()">Reset Password</button>
            <span class="login-link" onclick="checkAuthStatus()">Wapas Login karein</span>
        </div>
    </div>

    <div id="app-screen">
        
        <div id="sidebar">
            <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
            <a href="#">üè† Home</a>
            <a href="#" onclick="clearAllData()">‚ö†Ô∏è Clear All Data</a>
            <a href="#" onclick="logout()">üö™ Logout</a>
        </div>

        <header>
            <span class="menu-icon" onclick="openNav()">&#9776;</span>
            <span>Daily Milk Record</span>
            <span onclick="printBill()" style="font-size: 20px; cursor: pointer;">üñ®Ô∏è</span>
        </header>

        <div class="container">
            
            <div class="total-box">
                Total Bill: ‚Çπ <span id="grandTotal">0</span>
            </div>

            <div class="card form-card">
                <h3>üìù Naya Hisab Jodein</h3>
                <div class="form-group">
                    <label>Customer Name:</label>
                    <input type="text" id="custName" placeholder="Naam bole ya likhein">
                    <button class="voice-btn" onclick="startVoice('custName')">üé§</button>
                </div>
                <div style="display: flex; gap: 10px;">
                    <div class="form-group" style="flex:1">
                        <label>Liter (L):</label>
                        <input type="number" id="liters" placeholder="0">
                    </div>
                    <div class="form-group" style="flex:1">
                        <label>Rate (‚Çπ):</label>
                        <input type="number" id="rate" value="60">
                    </div>
                </div>
                <button class="btn" onclick="addEntry()">‚úÖ Save Entry</button>
            </div>

            <div class="card">
                <h3 style="display:flex; justify-content:space-between;">
                    üìÖ Record List <span style="font-size:14px; color:#777" id="entryCount">(0)</span>
                </h3>
                <div class="search-container">
                    <span class="search-icon">üîç</span>
                    <input type="text" id="searchBar" onkeyup="filterData()" placeholder="Naam se search karein...">
                </div>
                <table id="recordTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Name</th>
                            <th>Ltr/Price</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // --- DATA MANAGEMENT ---
        let milkData = JSON.parse(localStorage.getItem('milkData')) || [];
        let userCreds = JSON.parse(localStorage.getItem('userCreds')) || null;

        // Window Load Logic
        window.onload = function() {
            if(localStorage.getItem('isLoggedIn') === 'true') {
                showAppScreen();
            } else {
                checkAuthStatus();
            }
        };

        // --- AUTH SYSTEM LOGIC ---

        function checkAuthStatus() {
            hideAllScreens();
            if(userCreds) {
                // User already exists -> Show Login
                document.getElementById('login-screen').style.display = 'flex';
            } else {
                // No user -> Show Register
                document.getElementById('register-screen').style.display = 'flex';
            }
        }

        function registerUser() {
            let u = document.getElementById('reg-username').value;
            let p = document.getElementById('reg-password').value;
            let s = document.getElementById('reg-secret').value;

            if(u && p && s) {
                userCreds = { username: u, password: p, secret: s };
                localStorage.setItem('userCreds', JSON.stringify(userCreds));
                alert("‚úÖ Account Ban Gaya! Ab login karein.");
                checkAuthStatus();
            } else {
                alert("‚ùå Sabhi details bharna zaruri hai!");
            }
        }

        function login() {
            let u = document.getElementById('login-username').value;
            let p = document.getElementById('login-password').value;

            if(userCreds && u === userCreds.username && p === userCreds.password) {
                localStorage.setItem('isLoggedIn', 'true');
                showAppScreen();
            } else {
                alert("‚ùå Galat Username ya Password!");
            }
        }

        function showForgotScreen() {
            hideAllScreens();
            document.getElementById('forgot-screen').style.display = 'flex';
        }

        function resetPassword() {
            let s = document.getElementById('reset-secret').value;
            let newP = document.getElementById('new-password').value;

            if(userCreds && s === userCreds.secret) {
                if(newP) {
                    userCreds.password = newP;
                    localStorage.setItem('userCreds', JSON.stringify(userCreds));
                    alert("‚úÖ Password Reset ho gaya! Naya password use karein.");
                    checkAuthStatus();
                } else {
                    alert("Naya password dalein.");
                }
            } else {
                alert("‚ùå Secret Code galat hai!");
            }
        }

        function logout() {
            localStorage.removeItem('isLoggedIn');
            checkAuthStatus();
        }

        function hideAllScreens() {
            document.getElementById('register-screen').style.display = 'none';
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('forgot-screen').style.display = 'none';
            document.getElementById('app-screen').style.display = 'none';
        }

        function showAppScreen() {
            hideAllScreens();
            document.getElementById('app-screen').style.display = 'block';
            renderTable(milkData);
        }

        // --- APP CORE LOGIC (Same as before) ---
        function openNav() { document.getElementById("sidebar").style.width = "250px"; }
        function closeNav() { document.getElementById("sidebar").style.width = "0"; }

        function addEntry() {
            let name = document.getElementById("custName").value;
            let lit = parseFloat(document.getElementById("liters").value);
            let rate = parseFloat(document.getElementById("rate").value);
            
            if(!name || isNaN(lit) || isNaN(rate)) { alert("Sabhi details bharein!"); return; }

            let date = new Date();
            let dateStr = date.getDate() + "/" + (date.getMonth()+1) + " " + formatTime(date);

            let newEntry = { id: Date.now(), date: dateStr, name: name, liters: lit, rate: rate, total: lit * rate };

            milkData.unshift(newEntry);
            saveData();
            document.getElementById("custName").value = "";
            document.getElementById("liters").value = "";
            document.getElementById("searchBar").value = "";
            renderTable(milkData); 
            alert("‚úÖ Hisab Save Ho Gaya!");
        }

        function deleteEntry(id) {
            if(confirm("Entry delete karein?")) {
                milkData = milkData.filter(entry => entry.id !== id);
                saveData();
                filterData();
            }
        }

        function saveData() { localStorage.setItem('milkData', JSON.stringify(milkData)); }

        function filterData() {
            let query = document.getElementById("searchBar").value.toLowerCase();
            let filteredList = milkData.filter(item => item.name.toLowerCase().includes(query));
            renderTable(filteredList);
        }

        function renderTable(dataToRender) {
            let tableBody = document.getElementById("recordTable").getElementsByTagName('tbody')[0];
            tableBody.innerHTML = "";
            let grandTotal = 0;

            if (dataToRender.length === 0) {
                tableBody.innerHTML = "<tr><td colspan='4' style='text-align:center; color:red;'>Koi record nahi mila</td></tr>";
            }

            dataToRender.forEach(entry => {
                grandTotal += entry.total;
                let row = tableBody.insertRow();
                row.innerHTML = `
                    <td style="font-size:12px; color:#666">${entry.date}</td>
                    <td style="font-weight:bold">${entry.name}</td>
                    <td><div>${entry.liters} L</div><div style="font-weight:bold; color:#28a745">‚Çπ${entry.total}</div></td>
                    <td><button class="btn btn-danger" onclick="deleteEntry(${entry.id})">üóëÔ∏è</button></td>
                `;
            });
            document.getElementById("grandTotal").innerText = grandTotal.toFixed(2);
            document.getElementById("entryCount").innerText = `(${dataToRender.length})`;
        }

        function clearAllData() {
            if(confirm("Saara hisab delete ho jayega! Kya aap sure hain?")) {
                milkData = [];
                saveData();
                renderTable(milkData);
                closeNav();
            }
        }

        function formatTime(date) {
            let hours = date.getHours(); let minutes = date.getMinutes();
            let ampm = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12; hours = hours ? hours : 12; 
            minutes = minutes < 10 ? '0'+minutes : minutes;
            return hours + ':' + minutes + ' ' + ampm;
        }

        function printBill() { window.print(); }

        function startVoice(fieldId) {
            if ('webkitSpeechRecognition' in window) {
                var recognition = new webkitSpeechRecognition();
                recognition.lang = 'hi-IN';
                recognition.start();
                recognition.onresult = function(event) {
                    document.getElementById(fieldId).value = event.results[0][0].transcript;
                };
            } else { alert("Voice support nahi hai."); }
        }
    </script>
</body>
</html>
